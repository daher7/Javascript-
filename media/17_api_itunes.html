<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Música from iTunes</title>
    <script>

        // Declaramos las variables:
        const DIR_ITUNE = "https://itunes.apple.com/search?media=music&limit=20"
        var xhr = new XMLHttpRequest();
        var titulo = "";
        var datos_cancion;

        // Declaramos las funciones:
        function buscarCancion() {
            titulo = document.getElementById("titulo").value;
            console.log(titulo);

            //Generamos un objeto con el titulo de la cancion.
            var mensaje = {
                term: titulo
            }
            // Serializamos el mensaje y preparamos la llamada.
            var mensaje_json = JSON.stringify(mensaje);

            xhr.onreadystatechange = procersarRespuesta; // 
            xhr.open("GET", DIR_ITUNE + "&term="+titulo, true);         // Conexión con el servidor y le pasamos por la url el titulo de la cancion concatenándolo.
            xhr.getResponseHeader("Content-Type", "application/json");  // Preparamos el fichero MIME
            xhr.send(mensaje_json);  // Mandamos la canción.
            console.log(DIR_ITUNE + "&term="+titulo);
            return xhr.responseText; // Obtenemos la respuesta del servidor.
        }
        
        // Recogemos la informacion del servidor que le hemos enviado.
        function procersarRespuesta(){
            console.log("Procesar eventos invocados" + xhr.readyState);
            if(xhr.readyState == 4){
            // Se ha establecido la conexion con el servidor y esperamos la respuesta.
                if(xhr.status == 200){
                    console.log("Éxito");
                    //console.log(xhr.responseText);
                    // Desserializamos el mensaje que nos envía el servidor.
                    
                    datos_cancion = JSON.parse(xhr.responseText);
                    //Recorremos el array que es como nos devuelve los datos el servidor.
                    console.log(datos_cancion);  
                    
                    for(var i=0; i<=20; i++){
                        
                        console.log(datos = datos_cancion[i]);
                    }
                    
                } else {
                    console.log("Fracaso");
                }
            }
        }


    </script>
</head>

<body>
    <label for="titulo">Introduce el nombre de la canción:</label>
    <br>
    <input type="text" id="titulo">
    <button onclick="buscarCancion();">Buscar</button>
</body>

</html>