<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Música from iTunes</title>
    <link rel="stylesheet" href="css/itunes.css">
    <script>
        // Declaramos las variables:
        const DIR_ITUNE = "https://itunes.apple.com/search?media=music&limit=20"
        var xhr = new XMLHttpRequest();
        var titulo = "";
        var titulo_cancion;

        // Declaramos las funciones:
        function buscarCancion() {
            titulo = document.getElementById("titulo").value;

            xhr.onreadystatechange = procersarRespuesta; // 
            xhr.open("GET", DIR_ITUNE + "&term=" + titulo, true);       // Conexión con el servidor y le pasamos por la url el titulo de la cancion concatenándolo.
            xhr.getResponseHeader("Content-Type", "application/json");  // Preparamos el fichero MIME
            xhr.send(null);                                             // Mandamos el título de la canción.                     
        }


        // Recogemos la informacion del servidor que le hemos enviado.
        function procersarRespuesta() {
            console.log("Procesar eventos invocados " + xhr.readyState);
            if (xhr.readyState == 4 && xhr.status == 200) {
                // Se ha establecido la conexion con el servidor y esperamos la respuesta.

                console.log("Éxito");
                // Deserializamos el mensaje que nos envía el servidor.
                var datos_cancion = JSON.parse(xhr.responseText);

                //datos_cancion=datos_cancion.results;

                // Declaramos las variables para recorrer la informacion y "pintarla"
                var id;
                var grupo;
                var cancion;
                var portada;
                var precio;
                var moneda;
                var audio;

                //Recorremos el array, que es como nos devuelve los datos el servidor, y a la vez vamos imprimiendo los datos en pantalla.
                for (var i = 0; i < 20; i++) {
                
                    document.write("<table>");
                        document.write("<td>");
                        portada = datos_cancion.results[i].artworkUrl100;
                        document.write("<img src=" + portada + "> <br/>");
                       
                        id = datos_cancion.results[i].trackId;
                        console.log(id);
                        //document.write(id);

                        grupo = datos_cancion.results[i].artistName;
                        document.write(grupo);

                        cancion = datos_cancion.results[i].trackName;
                        document.write(cancion);

                        precio = datos_cancion.results[i].trackPrice;
                        document.write(precio);

                        moneda = datos_cancion.results[i].currency;
                        document.write(moneda);


                        audio = datos_cancion.results[i].previewUrl;
                        document.write("</td>");
                        //document.write("<audio src=" + audio + " controls>");
                    document.write("</table>");
                }
            } else {
                console.log("Fracaso");
            }


        }

    </script>
</head>

<body>
    <label for="titulo">Introduce el nombre de la canción:</label>
    <br>

    <div>
        <input type="text" id="titulo" onchange="buscarCancion();">
        <button onclick="buscarCancion();">Buscar</button>
    </div>





</body>

</html>